@model DataLayer.Entities.User.User

@{
    ViewData["Title"] = "جزئیات کاربر";
}

<div class="fade-in">
    <!-- Breadcrumb -->
    <div class="mb-6">
        <nav class="flex items-center space-x-2 space-x-reverse text-sm">
            <a asp-action="Index" class="text-purple-400 hover:text-purple-300 transition-colors">کاربران</a>
            <i class="fas fa-chevron-left text-slate-500"></i>
            <span class="text-slate-400">جزئیات کاربر</span>
        </nav>
    </div>

    <!-- Header -->
    <div class="flex items-center justify-between mb-8">
        <div>
            <h1 class="text-3xl font-bold text-white mb-2">جزئیات کاربر</h1>
            <p class="text-slate-400">اطلاعات کامل کاربر @Model.UserName</p>
        </div>
        <a asp-action="Index" class="px-6 py-3 bg-slate-700/50 text-slate-300 rounded-lg hover:bg-slate-700 transition-all">
            <i class="fas fa-arrow-right ml-2"></i>بازگشت
        </a>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <!-- User Profile Card -->
        <div class="lg:col-span-1">
            <div class="glass-card rounded-xl p-6 sticky top-6">
                <div class="text-center mb-6">
                    <div class="w-24 h-24 mx-auto rounded-full bg-gradient-to-br from-purple-500 to-pink-500 flex items-center justify-center text-white font-bold text-3xl mb-4">
                        @Model.UserName.Substring(0, 1).ToUpper()
                    </div>
                    <h2 class="text-xl font-bold text-white mb-1">@(Model.FirstName + " " + Model.LastName)</h2>
                    <p class="text-slate-400">@@@Model.UserName</p>
                </div>

                <div class="space-y-3 mb-6">
                    @if (Model.IsBan)
                    {
                        <div class="px-4 py-2 bg-red-500/20 text-red-400 rounded-lg text-center">
                            <i class="fas fa-ban ml-2"></i>حساب مسدود شده
                        </div>
                    }
                    else
                    {
                        <div class="px-4 py-2 bg-green-500/20 text-green-400 rounded-lg text-center">
                            <i class="fas fa-check-circle ml-2"></i>حساب فعال
                        </div>
                    }

                    @if (Model.IsEmailActive)
                    {
                        <div class="px-4 py-2 bg-green-500/20 text-green-400 rounded-lg text-center">
                            <i class="fas fa-envelope-circle-check ml-2"></i>ایمیل تایید شده
                        </div>
                    }

                    @if (Model.IsPhoneNumberActive)
                    {
                        <div class="px-4 py-2 bg-green-500/20 text-green-400 rounded-lg text-center">
                            <i class="fas fa-phone-circle-check ml-2"></i>شماره تایید شده
                        </div>
                    }

                    @if (Model.LoginWithGoogle)
                    {
                        <div class="px-4 py-2 bg-blue-500/20 text-blue-400 rounded-lg text-center">
                            <i class="fab fa-google ml-2"></i>ورود با گوگل
                        </div>
                    }
                </div>

                <div class="space-y-2">
                    <button onclick="toggleBan(@Model.UserId, @Model.IsBan.ToString().ToLower())" 
                            class="w-full px-4 py-3 bg-yellow-500/20 text-yellow-400 rounded-lg hover:bg-yellow-500/30 transition-all">
                        <i class="fas fa-user-shield ml-2"></i>@(Model.IsBan ? "فعال کردن حساب" : "مسدود کردن حساب")
                    </button>
                    <button onclick="deleteUser(@Model.UserId)" 
                            class="w-full px-4 py-3 bg-red-500/20 text-red-400 rounded-lg hover:bg-red-500/30 transition-all">
                        <i class="fas fa-trash ml-2"></i>حذف حساب کاربری
                    </button>
                </div>
            </div>
        </div>

        <!-- User Details -->
        <div class="lg:col-span-2">
            <div class="space-y-6">
                <!-- Personal Information -->
                <div class="glass-card rounded-xl p-6">
                    <h3 class="text-lg font-bold text-white mb-4 flex items-center">
                        <i class="fas fa-user ml-3 text-purple-400"></i>
                        اطلاعات شخصی
                    </h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="text-sm text-slate-400 mb-1 block">نام</label>
                            <p class="text-white font-medium">@Model.FirstName</p>
                        </div>
                        <div>
                            <label class="text-sm text-slate-400 mb-1 block">نام خانوادگی</label>
                            <p class="text-white font-medium">@Model.LastName</p>
                        </div>
                        <div>
                            <label class="text-sm text-slate-400 mb-1 block">نام کاربری</label>
                            <p class="text-white font-medium">@Model.UserName</p>
                        </div>
                        <div>
                            <label class="text-sm text-slate-400 mb-1 block">ایمیل</label>
                            <p class="text-white font-medium">@Model.Email</p>
                        </div>
                        <div>
                            <label class="text-sm text-slate-400 mb-1 block">شماره تماس</label>
                            <p class="text-white font-medium">@Model.PhoneNumber</p>
                        </div>
                    </div>
                </div>

                <!-- Account Information -->
                <div class="glass-card rounded-xl p-6">
                    <h3 class="text-lg font-bold text-white mb-4 flex items-center">
                        <i class="fas fa-shield-alt ml-3 text-blue-400"></i>
                        اطلاعات حساب
                    </h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="text-sm text-slate-400 mb-1 block">تاریخ ثبت‌نام</label>
                            <p class="text-white font-medium">@Model.RegisterDate.ToString("yyyy/MM/dd HH:mm")</p>
                        </div>
                        <div>
                            <label class="text-sm text-slate-400 mb-1 block">آخرین تغییرات</label>
                            <p class="text-white font-medium">@Model.LastChange.ToString("yyyy/MM/dd HH:mm")</p>
                        </div>
                        @if (Model.LastLoginDate.HasValue)
                        {
                            <div>
                                <label class="text-sm text-slate-400 mb-1 block">آخرین ورود</label>
                                <p class="text-white font-medium">@Model.LastLoginDate.Value.ToString("yyyy/MM/dd HH:mm")</p>
                            </div>
                        }
                        <div>
                            <label class="text-sm text-slate-400 mb-1 block">تعداد تلاش ناموفق</label>
                            <p class="text-white font-medium">@Model.TryCount بار</p>
                        </div>
                        @if (Model.LastTry.HasValue)
                        {
                            <div>
                                <label class="text-sm text-slate-400 mb-1 block">آخرین تلاش ناموفق</label>
                                <p class="text-white font-medium">@Model.LastTry.Value.ToString("yyyy/MM/dd HH:mm")</p>
                            </div>
                        }
                    </div>
                </div>

                <!-- Security Information -->
                <div class="glass-card rounded-xl p-6">
                    <h3 class="text-lg font-bold text-white mb-4 flex items-center">
                        <i class="fas fa-lock ml-3 text-green-400"></i>
                        اطلاعات امنیتی
                    </h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="text-sm text-slate-400 mb-1 block">کد فعال‌سازی</label>
                            <p class="text-white font-medium font-mono text-sm">@Model.ActiveCode</p>
                        </div>
                        <div>
                            <label class="text-sm text-slate-400 mb-1 block">کد امنیتی</label>
                            <p class="text-white font-medium font-mono text-sm">@Model.SecurityCode</p>
                        </div>
                        <div>
                            <label class="text-sm text-slate-400 mb-1 block">کد فعال‌سازی شماره</label>
                            <p class="text-white font-medium font-mono text-sm">@Model.ActivePhoneNumberCode</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        async function toggleBan(userId, isBan) {
            if (!confirm(isBan ? 'آیا میخواهید این کاربر را فعال کنید؟' : 'آیا میخواهید این کاربر را مسدود کنید؟')) {
                return;
            }

            try {
                const response = await fetch('/Admin/Users/ToggleBan', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ id: userId })
                });

                const result = await response.json();
                
                if (result.success) {
                    location.reload();
                } else {
                    alert(result.message);
                }
            } catch (error) {
                alert('خطا در انجام عملیات');
            }
        }

        async function deleteUser(userId) {
            if (!confirm('آیا از حذف این کاربر اطمینان دارید؟')) {
                return;
            }

            try {
                const response = await fetch('/Admin/Users/Delete?id=' + userId, {
                    method: 'POST'
                });

                const result = await response.json();
                
                if (result.success) {
                    window.location.href = '/Admin/Users';
                } else {
                    alert(result.message);
                }
            } catch (error) {
                alert('خطا در انجام عملیات');
            }
        }
    </script>
}
