@model DataLayer.Entities.User.User

@{
    ViewData["Title"] = "User Details";
}

<div class="fade-in">
    <!-- Breadcrumb -->
    <div class="mb-6">
        <nav class="flex items-center space-x-2 text-sm">
            <a asp-action="Index" class="text-purple-400 hover:text-purple-300 transition-colors">Users</a>
            <i class="fas fa-chevron-right text-slate-500"></i>
            <span class="text-slate-400">User Details</span>
        </nav>
    </div>

    <!-- Header -->
    <div class="flex items-center justify-between mb-8">
        <div>
            <h1 class="text-3xl font-bold text-white mb-2">User Details</h1>
            <p class="text-slate-400">Complete information for user @Model.UserName</p>
        </div>
        <a asp-action="Index" class="px-6 py-3 bg-slate-700/50 text-slate-300 rounded-lg hover:bg-slate-700 transition-all">
            <i class="fas fa-arrow-left mr-2"></i>Back
        </a>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <!-- User Profile Card -->
        <div class="lg:col-span-1">
            <div class="glass-card rounded-xl p-6 sticky top-6">
                <div class="text-center mb-6">
                    <div class="w-24 h-24 mx-auto rounded-full bg-gradient-to-br from-purple-500 to-pink-500 flex items-center justify-center text-white font-bold text-3xl mb-4">
                        @Model.UserName.Substring(0, 1).ToUpper()
                    </div>
                    <h2 class="text-xl font-bold text-white mb-1">@(Model.FirstName + " " + Model.LastName)</h2>
                    <p class="text-slate-400">@@@Model.UserName</p>
                    @if (Model.UserName.Equals("Admin", StringComparison.OrdinalIgnoreCase))
                    {
                        <span class="inline-block mt-2 px-3 py-1 text-xs bg-blue-500/20 text-blue-400 border border-blue-500/30 rounded-full">
                            <i class="fas fa-shield-halved mr-1"></i>Protected Account
                        </span>
                    }
                </div>

                <div class="space-y-3 mb-6">
                    @if (Model.IsBan)
                    {
                        <div class="px-4 py-2 bg-red-500/20 text-red-400 rounded-lg text-center">
                            <i class="fas fa-ban mr-2"></i>Account Banned
                        </div>
                    }
                    else
                    {
                        <div class="px-4 py-2 bg-green-500/20 text-green-400 rounded-lg text-center">
                            <i class="fas fa-check-circle mr-2"></i>Account Active
                        </div>
                    }

                    @if (Model.IsEmailActive)
                    {
                        <div class="px-4 py-2 bg-green-500/20 text-green-400 rounded-lg text-center">
                            <i class="fas fa-envelope-circle-check mr-2"></i>Email Verified
                        </div>
                    }

                    @if (Model.IsPhoneNumberActive)
                    {
                        <div class="px-4 py-2 bg-green-500/20 text-green-400 rounded-lg text-center">
                            <i class="fas fa-phone-circle-check mr-2"></i>Phone Verified
                        </div>
                    }

                    @if (Model.LoginWithGoogle)
                    {
                        <div class="px-4 py-2 bg-blue-500/20 text-blue-400 rounded-lg text-center">
                            <i class="fab fa-google mr-2"></i>Google Login
                        </div>
                    }
                </div>

                <div class="space-y-2">
                    @if (!Model.UserName.Equals("Admin", StringComparison.OrdinalIgnoreCase))
                    {
                        <a asp-action="Edit" asp-route-id="@Model.UserId" 
                           class="block w-full px-4 py-3 bg-purple-500/20 text-purple-400 rounded-lg hover:bg-purple-500/30 transition-all text-center">
                            <i class="fas fa-edit mr-2"></i>Edit User
                        </a>
                        <button onclick="toggleBan(@Model.UserId, @Model.IsBan.ToString().ToLower())" 
                                class="w-full px-4 py-3 bg-yellow-500/20 text-yellow-400 rounded-lg hover:bg-yellow-500/30 transition-all">
                            <i class="fas fa-user-shield mr-2"></i>@(Model.IsBan ? "Activate Account" : "Ban Account")
                        </button>
                        <button onclick="deleteUser(@Model.UserId)" 
                                class="w-full px-4 py-3 bg-red-500/20 text-red-400 rounded-lg hover:bg-red-500/30 transition-all">
                            <i class="fas fa-trash mr-2"></i>Delete Account
                        </button>
                    }
                    else
                    {
                        <div class="p-4 bg-slate-800/50 border border-slate-700 rounded-lg text-center">
                            <i class="fas fa-shield-halved text-3xl text-slate-600 mb-2"></i>
                            <p class="text-sm text-slate-400">This account is protected and cannot be modified</p>
                        </div>
                    }
                </div>
            </div>
        </div>

        <!-- User Details -->
        <div class="lg:col-span-2">
            <div class="space-y-6">
                <!-- Personal Information -->
                <div class="glass-card rounded-xl p-6">
                    <h3 class="text-lg font-bold text-white mb-4 flex items-center">
                        <i class="fas fa-user mr-3 text-purple-400"></i>
                        Personal Information
                    </h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="text-sm text-slate-400 mb-1 block">First Name</label>
                            <p class="text-white font-medium">@Model.FirstName</p>
                        </div>
                        <div>
                            <label class="text-sm text-slate-400 mb-1 block">Last Name</label>
                            <p class="text-white font-medium">@Model.LastName</p>
                        </div>
                        <div>
                            <label class="text-sm text-slate-400 mb-1 block">Username</label>
                            <p class="text-white font-medium">@Model.UserName</p>
                        </div>
                        <div>
                            <label class="text-sm text-slate-400 mb-1 block">Email</label>
                            <p class="text-white font-medium">@Model.Email</p>
                        </div>
                        <div>
                            <label class="text-sm text-slate-400 mb-1 block">Phone Number</label>
                            <p class="text-white font-medium">@Model.PhoneNumber</p>
                        </div>
                    </div>
                </div>

                <!-- User Roles -->
                @if (Model.UserRoles != null && Model.UserRoles.Any())
                {
                    <div class="glass-card rounded-xl p-6">
                        <h3 class="text-lg font-bold text-white mb-4 flex items-center">
                            <i class="fas fa-user-shield mr-3 text-indigo-400"></i>
                            Assigned Roles
                        </h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                            @foreach (var userRole in Model.UserRoles)
                            {
                                <div class="bg-gradient-to-r from-purple-500/10 to-pink-500/10 border border-purple-500/30 rounded-lg p-4">
                                    <div class="flex items-start justify-between">
                                        <div class="flex-1">
                                            <h4 class="text-white font-medium mb-1">@userRole.Role.DisplayName</h4>
                                            <p class="text-xs text-slate-400">@userRole.Role.RoleName</p>
                                            @if (!string.IsNullOrEmpty(userRole.Role.Description))
                                            {
                                                <p class="text-xs text-slate-500 mt-2">@userRole.Role.Description</p>
                                            }
                                        </div>
                                        <div class="ml-3">
                                            <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-purple-500/20 text-purple-400">
                                                <i class="fas fa-shield-halved mr-1"></i>
                                                Active
                                            </span>
                                        </div>
                                    </div>
                                    <div class="mt-3 pt-3 border-t border-purple-500/20">
                                        <p class="text-xs text-slate-500">
                                            <i class="far fa-calendar mr-1"></i>
                                            Assigned: @userRole.AssignedDate.ToString("yyyy/MM/dd HH:mm")
                                        </p>
                                    </div>
                                </div>
                            }
                        </div>
                    </div>
                }
                else
                {
                    <div class="glass-card rounded-xl p-6">
                        <h3 class="text-lg font-bold text-white mb-4 flex items-center">
                            <i class="fas fa-user-shield mr-3 text-indigo-400"></i>
                            Assigned Roles
                        </h3>
                        <div class="bg-yellow-500/10 border border-yellow-500/20 rounded-lg p-4 text-yellow-400 text-center">
                            <i class="fas fa-exclamation-triangle mr-2"></i>
                            No roles assigned to this user
                        </div>
                    </div>
                }

                <!-- Account Information -->
                <div class="glass-card rounded-xl p-6">
                    <h3 class="text-lg font-bold text-white mb-4 flex items-center">
                        <i class="fas fa-shield-alt mr-3 text-blue-400"></i>
                        Account Information
                    </h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="text-sm text-slate-400 mb-1 block">Registration Date</label>
                            <p class="text-white font-medium">@Model.RegisterDate.ToString("yyyy/MM/dd HH:mm")</p>
                        </div>
                        <div>
                            <label class="text-sm text-slate-400 mb-1 block">Last Updated</label>
                            <p class="text-white font-medium">@Model.LastChange.ToString("yyyy/MM/dd HH:mm")</p>
                        </div>
                        @if (Model.LastLoginDate.HasValue)
                        {
                            <div>
                                <label class="text-sm text-slate-400 mb-1 block">Last Login</label>
                                <p class="text-white font-medium">@Model.LastLoginDate.Value.ToString("yyyy/MM/dd HH:mm")</p>
                            </div>
                        }
                        <div>
                            <label class="text-sm text-slate-400 mb-1 block">Failed Login Attempts</label>
                            <p class="text-white font-medium">@Model.TryCount times</p>
                        </div>
                        @if (Model.LastTry.HasValue)
                        {
                            <div>
                                <label class="text-sm text-slate-400 mb-1 block">Last Failed Attempt</label>
                                <p class="text-white font-medium">@Model.LastTry.Value.ToString("yyyy/MM/dd HH:mm")</p>
                            </div>
                        }
                    </div>
                </div>

                <!-- Security Information -->
                <div class="glass-card rounded-xl p-6">
                    <h3 class="text-lg font-bold text-white mb-4 flex items-center">
                        <i class="fas fa-lock mr-3 text-green-400"></i>
                        Security Information
                    </h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="text-sm text-slate-400 mb-1 block">Activation Code</label>
                            <p class="text-white font-medium font-mono text-sm">@Model.ActiveCode</p>
                        </div>
                        <div>
                            <label class="text-sm text-slate-400 mb-1 block">Security Code</label>
                            <p class="text-white font-medium font-mono text-sm">@Model.SecurityCode</p>
                        </div>
                        <div>
                            <label class="text-sm text-slate-400 mb-1 block">Phone Activation Code</label>
                            <p class="text-white font-medium font-mono text-sm">@Model.ActivePhoneNumberCode</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        async function toggleBan(userId, isBan) {
            if (!confirm(isBan ? 'Do you want to activate this user?' : 'Do you want to ban this user?')) {
                return;
            }

            try {
                const response = await fetch('/Admin/Users/ToggleBan', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ id: userId })
                });

                const result = await response.json();
                
                if (result.success) {
                    location.reload();
                } else {
                    alert(result.message);
                }
            } catch (error) {
                alert('Error performing operation');
            }
        }

        async function deleteUser(userId) {
            if (!confirm('Are you sure you want to delete this user?')) {
                return;
            }

            try {
                const response = await fetch('/Admin/Users/Delete?id=' + userId, {
                    method: 'POST'
                });

                const result = await response.json();
                
                if (result.success) {
                    window.location.href = '/Admin/Users';
                } else {
                    alert(result.message);
                }
            } catch (error) {
                alert('Error performing operation');
            }
        }
    </script>
}
